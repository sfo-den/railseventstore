# This file is generated by .circleci/config.rb, do not edit it manually!
# Edit .circleci/config.rb and run ruby .circleci/config.rb

version: '2.1'
jobs:
  check_config:
    docker:
    - image: railseventstore/ruby:2.6
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run:
        name: Verify .circleci/config.yml is generated from .circleci/config.rb
        command: WAS="$(md5sum .circleci/config.yml)" && ruby .circleci/config.rb
          && test "$WAS" == "$(md5sum .circleci/config.yml)"
  mutate_aggregate_root_ruby_2_6:
    docker:
    - environment:
        MUTANT_JOBS: 4
      image: railseventstore/ruby:2.6
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C aggregate_root install mutate
  mutate_bounded_context_ruby_2_6:
    docker:
    - environment:
        MUTANT_JOBS: 4
      image: railseventstore/ruby:2.6
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C bounded_context install mutate
  mutate_ruby_event_store_ruby_2_6:
    docker:
    - environment:
        MUTANT_JOBS: 4
      image: railseventstore/ruby:2.6
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C ruby_event_store install mutate
  mutate_ruby_event_store_browser_ruby_2_6:
    docker:
    - environment:
        MUTANT_JOBS: 4
      image: railseventstore/ruby:2.6
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C ruby_event_store-browser install mutate
  mutate_ruby_event_store_rom_ruby_2_6:
    docker:
    - environment:
        MUTANT_JOBS: 4
      image: railseventstore/ruby:2.6
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C ruby_event_store-rom install mutate
  mutate_rails_event_store_ruby_2_6:
    docker:
    - environment:
        MUTANT_JOBS: 4
      image: railseventstore/ruby:2.6
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C rails_event_store install mutate
  mutate_rails_event_store_active_record_ruby_2_6:
    docker:
    - environment:
        MUTANT_JOBS: 4
      image: railseventstore/ruby:2.6
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C rails_event_store_active_record install mutate
  mutate_rails_event_store_rspec_ruby_2_6:
    docker:
    - environment:
        MUTANT_JOBS: 4
      image: railseventstore/ruby:2.6
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C rails_event_store-rspec install mutate
  test_aggregate_root_ruby_2_6:
    docker:
    - environment:
        DATABASE_URL: 'sqlite3::memory:'
      image: railseventstore/ruby:2.6
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C aggregate_root install test
  test_bounded_context_ruby_2_6:
    docker:
    - environment:
        DATABASE_URL: 'sqlite3::memory:'
      image: railseventstore/ruby:2.6
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C bounded_context install test
  test_ruby_event_store_ruby_2_6:
    docker:
    - environment:
        DATABASE_URL: 'sqlite3::memory:'
      image: railseventstore/ruby:2.6
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C ruby_event_store install test
  test_ruby_event_store_browser_ruby_2_6:
    docker:
    - environment:
        DATABASE_URL: 'sqlite3::memory:'
      image: railseventstore/ruby:2.6
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C ruby_event_store-browser install test
  test_ruby_event_store_rom_ruby_2_6:
    docker:
    - environment:
        DATABASE_URL: sqlite:db.sqlite3
      image: railseventstore/ruby:2.6
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C ruby_event_store-rom install test
  test_rails_event_store_ruby_2_6:
    docker:
    - environment:
        DATABASE_URL: 'sqlite3::memory:'
      image: railseventstore/ruby:2.6
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C rails_event_store install test
  test_rails_event_store_active_record_ruby_2_6:
    docker:
    - environment:
        DATABASE_URL: sqlite3:db.sqlite3
      image: railseventstore/ruby:2.6
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C rails_event_store_active_record install test
  test_rails_event_store_rspec_ruby_2_6:
    docker:
    - environment:
        DATABASE_URL: 'sqlite3::memory:'
      image: railseventstore/ruby:2.6
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C rails_event_store-rspec install test
  test_aggregate_root_ruby_2_4:
    docker:
    - environment:
        DATABASE_URL: 'sqlite3::memory:'
      image: railseventstore/ruby:2.4
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C aggregate_root install test
  test_bounded_context_ruby_2_4:
    docker:
    - environment:
        DATABASE_URL: 'sqlite3::memory:'
      image: railseventstore/ruby:2.4
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C bounded_context install test
  test_ruby_event_store_ruby_2_4:
    docker:
    - environment:
        DATABASE_URL: 'sqlite3::memory:'
      image: railseventstore/ruby:2.4
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C ruby_event_store install test
  test_ruby_event_store_browser_ruby_2_4:
    docker:
    - environment:
        DATABASE_URL: 'sqlite3::memory:'
      image: railseventstore/ruby:2.4
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C ruby_event_store-browser install test
  test_ruby_event_store_rom_ruby_2_4:
    docker:
    - environment:
        DATABASE_URL: sqlite:db.sqlite3
      image: railseventstore/ruby:2.4
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C ruby_event_store-rom install test
  test_rails_event_store_ruby_2_4:
    docker:
    - environment:
        DATABASE_URL: 'sqlite3::memory:'
      image: railseventstore/ruby:2.4
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C rails_event_store install test
  test_rails_event_store_active_record_ruby_2_4:
    docker:
    - environment:
        DATABASE_URL: sqlite3:db.sqlite3
      image: railseventstore/ruby:2.4
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C rails_event_store_active_record install test
  test_rails_event_store_rspec_ruby_2_4:
    docker:
    - environment:
        DATABASE_URL: 'sqlite3::memory:'
      image: railseventstore/ruby:2.4
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C rails_event_store-rspec install test
  test_aggregate_root_ruby_2_5:
    docker:
    - environment:
        DATABASE_URL: 'sqlite3::memory:'
      image: railseventstore/ruby:2.5
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C aggregate_root install test
  test_bounded_context_ruby_2_5:
    docker:
    - environment:
        DATABASE_URL: 'sqlite3::memory:'
      image: railseventstore/ruby:2.5
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C bounded_context install test
  test_ruby_event_store_ruby_2_5:
    docker:
    - environment:
        DATABASE_URL: 'sqlite3::memory:'
      image: railseventstore/ruby:2.5
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C ruby_event_store install test
  test_ruby_event_store_browser_ruby_2_5:
    docker:
    - environment:
        DATABASE_URL: 'sqlite3::memory:'
      image: railseventstore/ruby:2.5
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C ruby_event_store-browser install test
  test_ruby_event_store_rom_ruby_2_5:
    docker:
    - environment:
        DATABASE_URL: sqlite:db.sqlite3
      image: railseventstore/ruby:2.5
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C ruby_event_store-rom install test
  test_rails_event_store_ruby_2_5:
    docker:
    - environment:
        DATABASE_URL: 'sqlite3::memory:'
      image: railseventstore/ruby:2.5
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C rails_event_store install test
  test_rails_event_store_active_record_ruby_2_5:
    docker:
    - environment:
        DATABASE_URL: sqlite3:db.sqlite3
      image: railseventstore/ruby:2.5
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C rails_event_store_active_record install test
  test_rails_event_store_rspec_ruby_2_5:
    docker:
    - environment:
        DATABASE_URL: 'sqlite3::memory:'
      image: railseventstore/ruby:2.5
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C rails_event_store-rspec install test
  test_bounded_context_rails_4_2:
    docker:
    - environment:
        RAILS_VERSION: 4.2.11
      image: railseventstore/ruby:2.5
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C bounded_context install test
  test_rails_event_store_rails_4_2:
    docker:
    - environment:
        RAILS_VERSION: 4.2.11
      image: railseventstore/ruby:2.5
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C rails_event_store install test
  test_rails_event_store_active_record_rails_4_2:
    docker:
    - environment:
        RAILS_VERSION: 4.2.11
      image: railseventstore/ruby:2.5
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C rails_event_store_active_record install test
  test_rails_event_store_rspec_rails_4_2:
    docker:
    - environment:
        RAILS_VERSION: 4.2.11
      image: railseventstore/ruby:2.5
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C rails_event_store-rspec install test
  test_bounded_context_rails_5_0:
    docker:
    - environment:
        RAILS_VERSION: 5.0.7
      image: railseventstore/ruby:2.5
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C bounded_context install test
  test_rails_event_store_rails_5_0:
    docker:
    - environment:
        RAILS_VERSION: 5.0.7
      image: railseventstore/ruby:2.5
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C rails_event_store install test
  test_rails_event_store_active_record_rails_5_0:
    docker:
    - environment:
        RAILS_VERSION: 5.0.7
      image: railseventstore/ruby:2.5
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C rails_event_store_active_record install test
  test_rails_event_store_rspec_rails_5_0:
    docker:
    - environment:
        RAILS_VERSION: 5.0.7
      image: railseventstore/ruby:2.5
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C rails_event_store-rspec install test
  test_bounded_context_rails_5_1:
    docker:
    - environment:
        RAILS_VERSION: 5.1.6.1
      image: railseventstore/ruby:2.5
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C bounded_context install test
  test_rails_event_store_rails_5_1:
    docker:
    - environment:
        RAILS_VERSION: 5.1.6.1
      image: railseventstore/ruby:2.5
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C rails_event_store install test
  test_rails_event_store_active_record_rails_5_1:
    docker:
    - environment:
        RAILS_VERSION: 5.1.6.1
      image: railseventstore/ruby:2.5
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C rails_event_store_active_record install test
  test_rails_event_store_rspec_rails_5_1:
    docker:
    - environment:
        RAILS_VERSION: 5.1.6.1
      image: railseventstore/ruby:2.5
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C rails_event_store-rspec install test
  test_bounded_context_rails_6_0:
    docker:
    - environment:
        RAILS_VERSION: 6.0.0.rc1
      image: railseventstore/ruby:2.5
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C bounded_context install test
  test_rails_event_store_rails_6_0:
    docker:
    - environment:
        RAILS_VERSION: 6.0.0.rc1
      image: railseventstore/ruby:2.5
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C rails_event_store install test
  test_rails_event_store_active_record_rails_6_0:
    docker:
    - environment:
        RAILS_VERSION: 6.0.0.rc1
      image: railseventstore/ruby:2.5
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C rails_event_store_active_record install test
  test_rails_event_store_rspec_rails_6_0:
    docker:
    - environment:
        RAILS_VERSION: 6.0.0.rc1
      image: railseventstore/ruby:2.5
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C rails_event_store-rspec install test
  test_rails_event_store_active_record_mysql:
    docker:
    - environment:
        DATABASE_URL: mysql2://root:secret@127.0.0.1/rails_event_store?pool=5
      image: railseventstore/ruby:2.6
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C rails_event_store_active_record install test
  test_ruby_event_store_rom_mysql:
    docker:
    - environment:
        DATABASE_URL: mysql2://root:secret@127.0.0.1/rails_event_store?pool=5
      image: railseventstore/ruby:2.6
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C ruby_event_store-rom install test
  test_rails_event_store_active_record_postgres:
    docker:
    - environment:
        DATABASE_URL: postgres://postgres:secret@localhost/rails_event_store?pool=5
      image: railseventstore/ruby:2.6
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C rails_event_store_active_record install test
  test_ruby_event_store_rom_postgres:
    docker:
    - environment:
        DATABASE_URL: postgres://postgres:secret@localhost/rails_event_store?pool=5
      image: railseventstore/ruby:2.6
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C ruby_event_store-rom install test
  test_ruby_event_store_rom_data_type_json:
    docker:
    - environment:
        DATA_TYPE: json
        DATABASE_URL: postgres://postgres:secret@localhost/rails_event_store?pool=5
      image: railseventstore/ruby:2.6
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C ruby_event_store-rom install test
  test_ruby_event_store_rom_data_type_jsonb:
    docker:
    - environment:
        DATA_TYPE: jsonb
        DATABASE_URL: postgres://postgres:secret@localhost/rails_event_store?pool=5
      image: railseventstore/ruby:2.6
    - image: postgres:11
      environment:
      - POSTGRES_DB=rails_event_store
      - POSTGRES_PASSWORD=secret
      command: "-c max_connections=2000"
    - image: mysql:8
      environment:
      - MYSQL_DATABASE=rails_event_store
      - MYSQL_ROOT_PASSWORD=secret
      command: "--default-authentication-plugin=mysql_native_password --max-connections=2000"
    steps:
    - checkout
    - run: make -C ruby_event_store-rom install test
workflows:
  version: '2'
  Check configuration:
    jobs:
    - check_config
  Current Ruby:
    jobs:
    - test_aggregate_root_ruby_2_6
    - mutate_aggregate_root_ruby_2_6:
        requires:
        - test_aggregate_root_ruby_2_6
    - test_bounded_context_ruby_2_6
    - mutate_bounded_context_ruby_2_6:
        requires:
        - test_bounded_context_ruby_2_6
    - test_ruby_event_store_ruby_2_6
    - mutate_ruby_event_store_ruby_2_6:
        requires:
        - test_ruby_event_store_ruby_2_6
    - test_ruby_event_store_browser_ruby_2_6
    - mutate_ruby_event_store_browser_ruby_2_6:
        requires:
        - test_ruby_event_store_browser_ruby_2_6
    - test_ruby_event_store_rom_ruby_2_6
    - mutate_ruby_event_store_rom_ruby_2_6:
        requires:
        - test_ruby_event_store_rom_ruby_2_6
    - test_rails_event_store_ruby_2_6
    - mutate_rails_event_store_ruby_2_6:
        requires:
        - test_rails_event_store_ruby_2_6
    - test_rails_event_store_active_record_ruby_2_6
    - mutate_rails_event_store_active_record_ruby_2_6:
        requires:
        - test_rails_event_store_active_record_ruby_2_6
    - test_rails_event_store_rspec_ruby_2_6
    - mutate_rails_event_store_rspec_ruby_2_6:
        requires:
        - test_rails_event_store_rspec_ruby_2_6
  Ruby 2.5:
    jobs:
    - test_aggregate_root_ruby_2_5
    - test_bounded_context_ruby_2_5
    - test_ruby_event_store_ruby_2_5
    - test_ruby_event_store_browser_ruby_2_5
    - test_ruby_event_store_rom_ruby_2_5
    - test_rails_event_store_ruby_2_5
    - test_rails_event_store_active_record_ruby_2_5
    - test_rails_event_store_rspec_ruby_2_5
  Ruby 2.4:
    jobs:
    - test_aggregate_root_ruby_2_4
    - test_bounded_context_ruby_2_4
    - test_ruby_event_store_ruby_2_4
    - test_ruby_event_store_browser_ruby_2_4
    - test_ruby_event_store_rom_ruby_2_4
    - test_rails_event_store_ruby_2_4
    - test_rails_event_store_active_record_ruby_2_4
    - test_rails_event_store_rspec_ruby_2_4
  Rails 4.2:
    jobs:
    - test_bounded_context_rails_4_2
    - test_rails_event_store_rails_4_2
    - test_rails_event_store_active_record_rails_4_2
    - test_rails_event_store_rspec_rails_4_2
  Rails 5.0:
    jobs:
    - test_bounded_context_rails_5_0
    - test_rails_event_store_rails_5_0
    - test_rails_event_store_active_record_rails_5_0
    - test_rails_event_store_rspec_rails_5_0
  Rails 5.1:
    jobs:
    - test_bounded_context_rails_5_1
    - test_rails_event_store_rails_5_1
    - test_rails_event_store_active_record_rails_5_1
    - test_rails_event_store_rspec_rails_5_1
  Rails 6.0:
    jobs:
    - test_bounded_context_rails_6_0
    - test_rails_event_store_rails_6_0
    - test_rails_event_store_active_record_rails_6_0
    - test_rails_event_store_rspec_rails_6_0
  MySQL:
    jobs:
    - test_rails_event_store_active_record_mysql
    - test_ruby_event_store_rom_mysql
  PostgreSQL:
    jobs:
    - test_rails_event_store_active_record_postgres
    - test_ruby_event_store_rom_postgres
  JSONB data type:
    jobs:
    - test_ruby_event_store_rom_data_type_json
  JSON data type:
    jobs:
    - test_ruby_event_store_rom_data_type_jsonb
